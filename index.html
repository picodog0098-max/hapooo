
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hapuhub - دستیار هوشمند مراقبت از سگ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&family=Arimo:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
      :root {
        --bg-color: #121212;
        --surface-color: #1e1e1e;
        --primary-text: #e0e0e0;
        --secondary-text: #b3b3b3;
      }
      body {
        font-family: 'Vazirmatn', sans-serif;
        background-color: var(--bg-color);
        background-image: url('https://raw.githubusercontent.com/Shervinuri/Telbot/refs/heads/main/Picsart_25-11-10_19-03-13-347.png');
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        color: var(--primary-text);
        overflow: hidden;
      }
       body::before {
          content: '';
          position: fixed;
          top: 0; left: 0; right: 0; bottom: 0;
          background-color: rgba(0, 0, 0, 0.85);
          backdrop-filter: blur(5px);
          z-index: -1;
          transition: background-color 1s ease-in-out, backdrop-filter 1s ease-in-out;
      }
      body.chat-active::before {
          background-color: rgba(0, 0, 0, 0.2);
          backdrop-filter: blur(2px);
      }
      #bg-overlay {
          position: fixed;
          inset: 0;
          background-color: rgba(0,0,0,0);
          transition: background-color 0.8s ease-in-out;
          z-index: -1;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: rgba(20, 20, 20, 0.3); border-radius: 4px; }
      ::-webkit-scrollbar-thumb { background: rgba(85, 85, 85, 0.7); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #777; }
      
      .glass-effect {
        background-color: rgba(24, 24, 27, 0.7); /* Solid dark gray, almost black */
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }
      .modal-card {
        background-color: rgba(30, 30, 30, 0.85);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.15);
      }
      .chat-bubble {
          max-width: 85%;
          word-wrap: break-word;
          transition: all 0.3s ease-in-out;
      }
      .user-bubble { background-color: rgba(52, 53, 65, 0.9); border: 1px solid rgba(255,255,255,0.1); }
      .model-bubble { background-color: rgba(28, 100, 153, 0.7); border: 1px solid rgba(138, 180, 248, 0.2); }
      .sos-bubble { background-color: rgba(180, 50, 50, 0.8); border: 1px solid rgba(255, 150, 150, 0.3); }
      .chat-bubble-icon { color: rgba(255,255,255,0.5); font-size: 0.8rem; }
      
      .listening {
          animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(230, 120, 120, 0.7); }
        50% { box-shadow: 0 0 0 10px rgba(230, 120, 120, 0); }
      }
      .typing-indicator span {
          height: 8px; width: 8px; background-color: #9ca3af;
          border-radius: 50%; display: inline-block;
          animation: bounce 1.4s infinite ease-in-out both;
      }
      .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
      .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
      @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
      }
       .speaking { animation: speaking-pulse 1s infinite alternate; }
       @keyframes speaking-pulse {
        from { transform: scale(1); opacity: 1; }
        to { transform: scale(1.02); opacity: 0.95; }
       }
        .code-block {
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
            overflow-x: auto;
            border: 1px solid #444;
            font-family: 'Courier New', Courier, monospace;
            direction: ltr;
        }
        .inline-code {
            background-color: #444;
            border-radius: 4px;
            padding: 2px 5px;
            font-family: 'Courier New', Courier, monospace;
        }
        .shen-footer a {
            background: linear-gradient(90deg, #ff8a00, #e52e71, #4c2aff, #00d4ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradient-animation 5s ease infinite;
            background-size: 200% 200%;
        }
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Header -->
    <header class="glass-effect p-3 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-3">
            <img src="https://raw.githubusercontent.com/Shervinuri/Telbot/refs/heads/main/Picsart_25-11-10_19-03-13-347-removebg-preview.png" alt="Hapuhub Logo" class="w-10 h-10 rounded-full border-2 border-gray-500">
            <h1 class="text-xl font-bold text-gray-200" style="font-family: 'Arimo', sans-serif;">Hapuhub</h1>
        </div>
        <div class="flex items-center gap-4">
             <button id="profile-btn" aria-label="پروفایل حیوان خانگی" class="text-gray-300 hover:text-white transition-colors p-2 rounded-full hover:bg-white/10 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-id-card-clip text-xl"></i>
            </button>
            <button id="header-sos-btn" aria-label="حالت اضطراری" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full transition-all duration-300 shadow-md hover:shadow-lg disabled:opacity-50 disabled:bg-gray-500 disabled:cursor-not-allowed">
                <i class="fas fa-biohazard mr-2"></i>SOS
            </button>
        </div>
    </header>

    <!-- Chat History -->
    <main id="chat-history" class="flex-1 p-4 overflow-y-auto flex flex-col-reverse gap-4"></main>

     <!-- Video Stream View -->
    <div id="stream-view" class="hidden fixed inset-0 bg-black z-40 flex flex-col items-center justify-center p-4">
        <video id="video-feed" class="w-full h-full object-contain" autoplay playsinline></video>
        <canvas id="video-canvas" class="hidden"></canvas> <!-- Hidden canvas for frame grabbing -->
        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black to-transparent">
             <p id="stream-transcription" class="text-white text-center text-lg font-semibold mb-4"></p>
             <button id="stop-stream-btn" class="mx-auto block bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full transition-all duration-300">
                <i class="fas fa-phone-slash mr-2"></i>پایان تماس اضطراری
            </button>
        </div>
    </div>
    
    <!-- Input Area -->
    <footer class="glass-effect p-3">
        <div class="flex items-center gap-2">
             <label id="upload-label" for="image-upload" class="cursor-pointer text-gray-400 hover:text-white transition-colors p-3 rounded-full hover:bg-white/10">
                <i class="fas fa-paperclip text-xl"></i>
                <input id="image-upload" type="file" class="hidden" accept="image/*">
            </label>
            <input type="text" id="chat-input" placeholder="در حال آماده‌سازی دستیار..." class="flex-1 bg-transparent border-2 border-gray-600 rounded-full py-3 px-5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all disabled:opacity-50" disabled>
            <button id="main-action-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg hover:scale-105 disabled:opacity-50 disabled:bg-gray-500 disabled:cursor-not-allowed" disabled>
                <i class="fa-solid fa-lock"></i>
            </button>
        </div>
        <p class="shen-footer text-center text-xs mt-2">
            <a href="https://T.me/IAMHamidrreza" target="_blank">Exclusive HMZ made</a>
        </p>
    </footer>

    <!-- Profile Modal -->
    <div id="profile-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4" aria-hidden="true" role="dialog">
        <div class="modal-card rounded-lg p-6 w-full max-w-sm">
            <h2 class="text-xl font-bold mb-4">پروفایل حیوان خانگی</h2>
            <div class="space-y-4">
                <input type="text" id="pet-name" placeholder="نام" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="pet-breed" placeholder="نژاد" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="pet-age" placeholder="سن" class="w-full bg-gray-800 border border-gray-600 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button id="profile-cancel-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md transition-colors">لغو</button>
                <button id="profile-save-btn" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md transition-colors">ذخیره</button>
            </div>
        </div>
    </div>
    
     <!-- SOS Modal -->
    <div id="sos-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4" aria-hidden="true" role="dialog">
        <div class="modal-card rounded-lg p-6 w-full max-w-sm text-center">
            <i class="fas fa-biohazard text-5xl text-red-500 mb-4"></i>
            <h2 class="text-xl font-bold mb-2">حالت اضطراری</h2>
            <p class="text-gray-300 mb-6">در شرایط اورژانسی، کدام راه ارتباطی را ترجیح می‌دهید؟</p>
            <div class="flex flex-col gap-3">
                <button id="sos-stream-btn" class="bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-md transition-colors w-full"><i class="fas fa-video mr-2"></i>تماس ویدیویی زنده</button>
                <button id="sos-audio-btn" class="bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-md transition-colors w-full"><i class="fas fa-microphone-alt mr-2"></i>تماس صوتی</button>
                <button id="sos-cancel-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md transition-colors mt-4">لغو</button>
            </div>
        </div>
    </div>

    <!-- Main Script -->
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://sdk.gemini.ai/v1_1/gemini-generated-js/gemini.js"
        }
      }
    </script>
    <script type="module" src="./index.js"></script>
</body>
</html>
